"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[36759],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=i,h=p["".concat(s,".").concat(u)]||p[u]||c[u]||o;return n?a.createElement(h,r(r({ref:t},m),{},{components:n})):a.createElement(h,r({ref:t},m))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},19487:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>d,default:()=>y,frontMatter:()=>s,metadata:()=>m,toc:()=>c});var a=n(87462),i=(n(67294),n(3905));const o="data:image/png;base64,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2WE2AyeP5wqt3LGeup73XXemt868v52s759xTzWa9f7Ylo+xcnOv1XnbiLHWfWY59P+Tyb76o+Yzzp5o7DZzbqLbORPiafUhK/s+uGu4wCo/6mxMZPLn9m2orW0fy3/IaqZ/6zHvO7t4pL62tuFfFw3G4M6a2t6uj7MyW5COmtra+KC3mTAbE7MIbkyN20+Yyx7wjnrfM7v38FZgdWnCW5UmLuWn7BbqoveFz7yXNQ/5KfOEeZydnNszeRdbm/f2aL7tC95adnk0NWVemJsqXKKnpwJh75fD4KX2U3rvuvaJ4NB4h7kCq0/ZB/vwYumqrXJ/2+v/elc8XaVVbqCm9XSRTaurtTLrS7jX4f9HV79eFV+y4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4smKJyuerHiy4hmrutSripSui6zbWKNIG9dFmhQt0plKK1KqM5JItilSMhFJJBxFSsgKJyuerHiy4smKJyuerHiy4smKJyteuKxilSUlJd+u8oabK+6P2xMP2mfCUKisVt9cXh2NPnlrZcxxNi1c3uA4v7zhkZ3Bk/NfmKyqF6yINTtO4zOL7ov7VlW3rjSTKyyFyCr+s++vt4PdDy95xlqtvvEn9fZMOAqR1cbbK3f7o+rlj3tW1YvuqfNPhKMQWa1dYRd103N3VsY3Lbx98V1/bQnOhKIQWa2pfCoYedffpoWRr//arF4hKsRWpYtvXB2cCEchslp3x8+D0fplj7RsWrhs3Q8WVAdnQlGIrHYtvXOzP3piyWpvbr245pbFNf6ZUBQiq5bf3/SAHdSU3ttor8Omp76zwmxLw1KIrJzGh67zfq+pvuOu54J9e+ND3zDb0rAUJiunfu3ia0tKbnrM271bK6d+2TVLgwtz/guVlbM7Fo1G6+xM2h3b4W2udkZjwQZ1/guXVbiTFU9WPFnxZMWTFU9WPFnxZMUzVi/19CpSz0uR1rY9itTWGglmmPrkdM82Tfds83TPNk97Bp6seLLiyYonK56seLLiyYonK94XyypW6d12O1/Nu9XmihITJNhWXr4tGM5D82314Fcro9HoqkcZQVFbVd2zyrt/vbGB3e1YzFb2TqtPUTFbPVHx52DkONWlZt160P5xyVO3BH9oYv/m5P64fbxldVFbxSvvfC4YOvGqx6LRRxZXOZsWXlOxPrrMu6+25ofl1dHf/qFh84/M48qy1cVs1bC8bGswdFoa4o7zQpl3Y/uCdc3O+u/dG4+tKDWjpsaWBxasaXaiZRWxorYq/NZrykq+9qW7t29aWPGi42wtW96wYfnD9j612JKluxyn+d5FzxexVctPb9sQDM0ydf2votWl5dv8mx+3ld+9fe2SR+1Tzy+65lqzbn15wfpiXturSp8IRs6q8ifr7Xp02ap825q7fautZXfVmE1YdHtTMVvtqCi9fAP7o8vXOc6G2wqttpQvtdv5+mWLo/Y1xby2Oy3Pln7X+zuS6t/FfvOtXzixFZFCq+ZVN9wXd2r+0rB2wY8NWlVVUVs5u2Mrv2mWoq/c3xxfeV3JzQ8VrFdGJf7H268tuf7xlqY/3fa1kpKl0eK2MhfYFm8pMr/omEFdfSzW7N+s3WxGjtO0PRrdUu8/Rs0J/+x8Ne9WX6BkxZMVT1Y8WfFkxZMVT1Y8WfGMle7ZhumebV5b6/8AB50sOY1fFUgAAAAASUVORK5CYII=",r=n.p+"assets/images/adding-new-item-run-18096e13372b7535a169be0729074132.gif",l=n.p+"assets/images/adding-new-items-2-run-3a59a3f7289bd7176ece9e7ed0728348.gif",s={id:"adding-new-items",title:"Adding new Items"},d=void 0,m={unversionedId:"tutorials/todo-list-app/adding-new-items",id:"version-0.10.x/tutorials/todo-list-app/adding-new-items",title:"Adding new Items",description:'When we originally created the TodoListView we added an "Add an item" button. It\'s time now to make that button do something. When the button is clicked we want to replace the list of items with a new view which will allow the user to enter the description of a new item.',source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/version-0.10.x/tutorials/todo-list-app/adding-new-items.md",sourceDirName:"tutorials/todo-list-app",slug:"/tutorials/todo-list-app/adding-new-items",permalink:"/avalonia-docs/zh-Hans/docs/tutorials/todo-list-app/adding-new-items",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/versioned_docs/version-0.10.x/tutorials/todo-list-app/adding-new-items.md",tags:[],version:"0.10.x",frontMatter:{id:"adding-new-items",title:"Adding new Items"},sidebar:"documentationSidebar",previous:{title:"Locating Views",permalink:"/avalonia-docs/zh-Hans/docs/tutorials/todo-list-app/locating-views"},next:{title:"Music Store App",permalink:"/avalonia-docs/zh-Hans/docs/tutorials/music-store-app/"}},p={},c=[{value:"Create the view",id:"create-the-view",level:3},{value:"Create the view model",id:"create-the-view-model",level:3},{value:"Swap out the list view model",id:"swap-out-the-list-view-model",level:3},{value:"Run the application",id:"run-the-application",level:3},{value:"Implement the OK and Cancel commands",id:"implement-the-ok-and-cancel-commands",level:3},{value:"Bind the OK and Cancel buttons",id:"bind-the-ok-and-cancel-buttons",level:3},{value:"Handle the OK and Cancel button",id:"handle-the-ok-and-cancel-button",level:3},{value:"Run the application",id:"run-the-application-1",level:3}],u={toc:c},h="wrapper";function y(e){let{components:t,...n}=e;return(0,i.kt)(h,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"When we originally created the ",(0,i.kt)("inlineCode",{parentName:"p"},"TodoListView"),' we added an "Add an item" button. It\'s time now to make that button do something. When the button is clicked we want to replace the list of items with a new view which will allow the user to enter the description of a new item.'),(0,i.kt)("h3",{id:"create-the-view"},"Create the view"),(0,i.kt)("p",null,"We start by creating the view ","(","see ",(0,i.kt)("a",{parentName:"p",href:"../todo-list-app/creating-a-view#create-the-usercontrol"},"here")," for a refresher on how to create a ",(0,i.kt)("inlineCode",{parentName:"p"},"UserControl")," using a template",")",":"),(0,i.kt)("p",null,"Views/AddItemView.axaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup"},'<UserControl xmlns="https://github.com/avaloniaui"\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="300"\n             x:Class="Todo.Views.AddItemView">\n  <DockPanel>\n    <Button DockPanel.Dock="Bottom">Cancel</Button>\n    <Button DockPanel.Dock="Bottom">OK</Button>\n    <TextBox AcceptsReturn="True"\n             Text="{Binding Description}"\n             Watermark="Enter your TODO"/>\n  </DockPanel>\n</UserControl>\n')),(0,i.kt)("p",null,"This gives us a view which looks like this:"),(0,i.kt)("img",{className:"center",src:o,alt:"The view"}),(0,i.kt)("p",null,"The only new thing here is the ",(0,i.kt)("inlineCode",{parentName:"p"},"<TextBox>")," control which is a control that allows a user to input text. We set three properties on it:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AcceptsReturn")," creates a multi-line ",(0,i.kt)("inlineCode",{parentName:"li"},"TextBox")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Text")," binds the text that is displayed in the ",(0,i.kt)("inlineCode",{parentName:"li"},"TextBox")," to the ",(0,i.kt)("inlineCode",{parentName:"li"},"Description")," property on the view model"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Watermark")," causes a placeholder to be displayed when the ",(0,i.kt)("inlineCode",{parentName:"li"},"TextBox")," is empty")),(0,i.kt)("h3",{id:"create-the-view-model"},"Create the view model"),(0,i.kt)("p",null,"Our view model is going to start out ",(0,i.kt)("em",{parentName:"p"},"extremely")," simple. We're just going to provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"Description")," property that the ",(0,i.kt)("inlineCode",{parentName:"p"},"TextBox")," is bound to for starters. We'll add to this as we go along."),(0,i.kt)("p",null,"ViewModels\\AddItemViewModel.cs"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"namespace Todo.ViewModels\n{\n    class AddItemViewModel : ViewModelBase\n    {\n        public string Description { get; set; }\n    }\n}\n")),(0,i.kt)("h3",{id:"swap-out-the-list-view-model"},"Swap out the list view model"),(0,i.kt)("p",null,'When we click the "Add an item" button, we want to stop showing the ',(0,i.kt)("inlineCode",{parentName:"p"},"TodoListView")," in the window and show the ",(0,i.kt)("inlineCode",{parentName:"p"},"AddItemView"),". We can alter the ",(0,i.kt)("inlineCode",{parentName:"p"},"MainWindowViewModel")," to let us do this:"),(0,i.kt)("p",null,"ViewModels/MainWindowViewModel.cs"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using ReactiveUI;\nusing Todo.Services;\n\nnamespace Todo.ViewModels\n{\n    class MainWindowViewModel : ViewModelBase\n    {\n        ViewModelBase content;\n\n        public MainWindowViewModel(Database db)\n        {\n            Content = List = new TodoListViewModel(db.GetItems());\n        }\n\n        public ViewModelBase Content\n        {\n            get => content;\n            private set => this.RaiseAndSetIfChanged(ref content, value);\n        }\n\n        public TodoListViewModel List { get; }\n\n        public void AddItem()\n        {\n            Content = new AddItemViewModel();\n        }\n    }\n}\n\n")),(0,i.kt)("p",null,"Here we add a ",(0,i.kt)("inlineCode",{parentName:"p"},"Content")," property which is initially set to our list view model. When the ",(0,i.kt)("inlineCode",{parentName:"p"},"AddItem()")," method is called, we assign an ",(0,i.kt)("inlineCode",{parentName:"p"},"AddItemViewModel")," to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Content")," property."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Content")," property setter calls ",(0,i.kt)("inlineCode",{parentName:"p"},"RaiseAndSetIfChanged")," which will cause ",(0,i.kt)("a",{parentName:"p",href:"../../data-binding/change-notifications"},"a change notification")," to be fired each time the property changes value. Avalonia's binding system needs change notifications in order to know when to update the user-interface in response to a property change."),(0,i.kt)("p",null,"We now want to bind our ",(0,i.kt)("inlineCode",{parentName:"p"},"Window.Content")," property to this new ",(0,i.kt)("inlineCode",{parentName:"p"},"Content")," property instead of the ",(0,i.kt)("inlineCode",{parentName:"p"},"List")," property that it is currently bound to:"),(0,i.kt)("p",null,"Views/MainWindow.axaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup"},'<Window xmlns="https://github.com/avaloniaui"\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n        x:Class="Todo.Views.MainWindow"\n        Icon="/Assets/avalonia-logo.ico"\n        Width="200" Height="300"\n        Title="Avalonia Todo"\n        Content="{Binding Content}">\n</Window>\n')),(0,i.kt)("p",null,'And finally we need to make the "Add an item" button call ',(0,i.kt)("inlineCode",{parentName:"p"},"MainWindowViewModel.AddItem()"),"."),(0,i.kt)("p",null,"Views/TodoListView.axaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup"},'<UserControl xmlns="https://github.com/avaloniaui"\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="300"\n             x:Class="Todo.Views.TodoListView">\n  <DockPanel>\n    <Button DockPanel.Dock="Bottom"\n            Command="{Binding $parent[Window].DataContext.AddItem}">\n      Add an item\n    </Button>\n    <ItemsControl Items="{Binding Items}">\n      <ItemsControl.ItemTemplate>\n        <DataTemplate>\n          <CheckBox Margin="4"\n                    IsChecked="{Binding IsChecked}"\n                    Content="{Binding Description}"/>\n        </DataTemplate>\n      </ItemsControl.ItemTemplate>\n    </ItemsControl>\n  </DockPanel>\n</UserControl>\n')),(0,i.kt)("p",null,"The binding we've added to ",(0,i.kt)("inlineCode",{parentName:"p"},"<Button>")," is:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup"},'Command="{Binding $parent[Window].DataContext.AddItem}"\n')),(0,i.kt)("p",null,"There are a few parts to this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Button.Command")," property describes a command to be called when the button is clicked"),(0,i.kt)("li",{parentName:"ul"},"We're binding it to ",(0,i.kt)("inlineCode",{parentName:"li"},"$parent[Window].DataContext.AddItem"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$parent[Window]")," means find an ancestor control of type ",(0,i.kt)("inlineCode",{parentName:"li"},"Window")),(0,i.kt)("li",{parentName:"ul"},"And get its ",(0,i.kt)("inlineCode",{parentName:"li"},"DataContext")," ","(","i.e. a ",(0,i.kt)("inlineCode",{parentName:"li"},"MainWindowViewModel")," in this case",")"),(0,i.kt)("li",{parentName:"ul"},"And bind to the ",(0,i.kt)("inlineCode",{parentName:"li"},"AddItem")," method on that view model")))),(0,i.kt)("p",null,"This will cause the ",(0,i.kt)("inlineCode",{parentName:"p"},"MainWindowViewModel.AddItem()")," method to be invoked when the button is clicked."),(0,i.kt)("p",null,"If you're familiar with WPF or UWP you may think it strange that we're binding ",(0,i.kt)("inlineCode",{parentName:"p"},"Button.Command")," to a method. This is a convenience feature of Avalonia which means that you don't have to create an ",(0,i.kt)("inlineCode",{parentName:"p"},"ICommand")," for simple commands that are always enabled."),(0,i.kt)("h3",{id:"run-the-application"},"Run the application"),(0,i.kt)("p",null,'If you now run the application and click the "Add an item" button you should see the new view appear.'),(0,i.kt)("img",{className:"center",src:r,alt:"The running application"}),(0,i.kt)("p",null,'Now we have the "Add new item" view appearing we need to make it work. In particular we need to enable/disable the OK button depending on whether the user has typed anything in the ',(0,i.kt)("inlineCode",{parentName:"p"},"Description"),"."),(0,i.kt)("h3",{id:"implement-the-ok-and-cancel-commands"},"Implement the OK and Cancel commands"),(0,i.kt)("p",null,"In the last section we bound a ",(0,i.kt)("inlineCode",{parentName:"p"},"Button.Command")," to a method on the view model, but if we want to be able to control the enabled state of the button we need to bind to an ",(0,i.kt)("a",{parentName:"p",href:"../../data-binding/binding-to-commands"},(0,i.kt)("inlineCode",{parentName:"a"},"ICommand")),". Again we're going to take advantage of ReactiveUI and use ",(0,i.kt)("a",{parentName:"p",href:"https://reactiveui.net/docs/handbook/commands/"},(0,i.kt)("inlineCode",{parentName:"a"},"ReactiveCommand")),"."),(0,i.kt)("p",null,"ViewModels\\AddItemViewModel.cs"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using System.Reactive;\nusing ReactiveUI;\nusing Todo.Models;\n\nnamespace Todo.ViewModels\n{\n    class AddItemViewModel : ViewModelBase\n    {\n        string description;\n\n        public AddItemViewModel()\n        {\n            var okEnabled = this.WhenAnyValue(\n                x => x.Description,\n                x => !string.IsNullOrWhiteSpace(x));\n\n            Ok = ReactiveCommand.Create(\n                () => new TodoItem { Description = Description }, \n                okEnabled);\n            Cancel = ReactiveCommand.Create(() => { });\n        }\n\n        public string Description\n        {\n            get => description;\n            set => this.RaiseAndSetIfChanged(ref description, value);\n        }\n\n        public ReactiveCommand<Unit, TodoItem> Ok { get; }\n        public ReactiveCommand<Unit, Unit> Cancel { get; }\n    }\n}\n")),(0,i.kt)("p",null,"First we modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"Description")," property to raise ",(0,i.kt)("a",{parentName:"p",href:"../../data-binding/change-notifications"},"change notifications"),". We ",(0,i.kt)("a",{parentName:"p",href:"adding-new-items#swap-out-the-list-view-model"},"saw this pattern before")," in the main window view model. In this case though, we're implementing change notifications for ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactiveUI")," rather than for Avalonia specifically:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var okEnabled = this.WhenAnyValue(\n    x => x.Description,\n    x => !string.IsNullOrWhiteSpace(x));\n")),(0,i.kt)("p",null,"Now that ",(0,i.kt)("inlineCode",{parentName:"p"},"Description")," has change notifications enabled we can use ",(0,i.kt)("a",{parentName:"p",href:"https://reactiveui.net/docs/handbook/when-any/"},(0,i.kt)("inlineCode",{parentName:"a"},"WhenAnyValue"))," to convert the property into a stream of values in the form of an ",(0,i.kt)("a",{parentName:"p",href:"http://introtorx.com/Content/v1.0.10621.0/02_KeyTypes.html#KeyTypes"},(0,i.kt)("inlineCode",{parentName:"a"},"IObservable")),"."),(0,i.kt)("p",null,"This above code can be read as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"For the initial value of ",(0,i.kt)("inlineCode",{parentName:"li"},"Description"),", and for subsequent changes"),(0,i.kt)("li",{parentName:"ul"},"Select the inverse of the result of invoking ",(0,i.kt)("inlineCode",{parentName:"li"},"string.IsNullOrWhiteSpace()")," with the value")),(0,i.kt)("p",null,"This means that ",(0,i.kt)("inlineCode",{parentName:"p"},"okEnabled")," represents a stream of ",(0,i.kt)("inlineCode",{parentName:"p"},"bool")," values which will produce ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," when ",(0,i.kt)("inlineCode",{parentName:"p"},"Description")," is a non-empty string and ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," when it is an empty string. This is exactly how we want the ",(0,i.kt)("inlineCode",{parentName:"p"},"OK")," button to be enabled."),(0,i.kt)("p",null,"We then create a ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactiveCommand")," and assign it to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Ok")," property:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"Ok = ReactiveCommand.Create(\n    () => new TodoItem { Description = Description }, \n    okEnabled);\n")),(0,i.kt)("p",null,"The second parameter to ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactiveCommand.Create")," controls the enabled state of the command, and so the observable we just created is passed there."),(0,i.kt)("p",null,"The first parameter is a lambda that is run when the command is executed. Here we simply create an instance of our model ",(0,i.kt)("inlineCode",{parentName:"p"},"TodoItem")," with the description entered by the user."),(0,i.kt)("p",null,'We also create a command for the "Cancel" button:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"Cancel = ReactiveCommand.Create(() => { });\n")),(0,i.kt)("p",null,'The cancel command is always enabled so we don\'t pass an observable to control its state, we just pass an "execute" lambda which in this case does nothing.'),(0,i.kt)("h3",{id:"bind-the-ok-and-cancel-buttons"},"Bind the OK and Cancel buttons"),(0,i.kt)("p",null,"We can now bind the OK and Cancel buttons in the view to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Ok")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Cancel")," commands we just created on the view model:"),(0,i.kt)("p",null,"Views/AddItemView.axaml"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-markup"},'<UserControl xmlns="https://github.com/avaloniaui"\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n             mc:Ignorable="d" d:DesignWidth="200" d:DesignHeight="300"\n             x:Class="Todo.Views.AddItemView">\n  <DockPanel>\n    <Button DockPanel.Dock="Bottom" Command="{Binding Cancel}">Cancel</Button>\n    <Button DockPanel.Dock="Bottom" Command="{Binding Ok}">OK</Button>\n    <TextBox AcceptsReturn="False"\n             Text="{Binding Description}"\n             Watermark="Enter your TODO"/>\n  </DockPanel>\n</UserControl>\n\n')),(0,i.kt)("p",null,'If you run the application and go to the "Add Item" view you should now see that the OK button is only enabled when text has been entered in the description ',(0,i.kt)("inlineCode",{parentName:"p"},"TextBox"),"."),(0,i.kt)("h3",{id:"handle-the-ok-and-cancel-button"},"Handle the OK and Cancel button"),(0,i.kt)("p",null,"We now need to react to the OK or Cancel buttons being pressed and re-show the list. If OK was pressed we also need to add the new item to the list. We'll implement this functionality in ",(0,i.kt)("inlineCode",{parentName:"p"},"MainWindowViewModel"),":"),(0,i.kt)("p",null,"ViewModels/MainWindowViewModel.cs"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using System;\nusing System.Reactive.Linq;\nusing ReactiveUI;\nusing Todo.Models;\nusing Todo.Services;\n\nnamespace Todo.ViewModels\n{\n    class MainWindowViewModel : ViewModelBase\n    {\n        ViewModelBase content;\n\n        public MainWindowViewModel(Database db)\n        {\n            Content = List = new TodoListViewModel(db.GetItems());\n        }\n\n        public ViewModelBase Content\n        {\n            get => content;\n            private set => this.RaiseAndSetIfChanged(ref content, value);\n        }\n\n        public TodoListViewModel List { get; }\n\n        public void AddItem()\n        {\n            var vm = new AddItemViewModel();\n\n            Observable.Merge(\n                vm.Ok,\n                vm.Cancel.Select(_ => (TodoItem)null))\n                .Take(1)\n                .Subscribe(model =>\n                {\n                    if (model != null)\n                    {\n                        List.Items.Add(model);\n                    }\n\n                    Content = List;\n                });\n\n            Content = vm;\n        }\n    }\n}\n")),(0,i.kt)("p",null,"There are a few parts to the added code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"Observable.Merge(vm.Ok, vm.Cancel.Select(_ => (TodoItem)null))\n")),(0,i.kt)("p",null,"This code takes advantage of the fact that ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactiveCommand")," is itself an observable which produces a value each time the command is executed. You'll notice that when we defined the commands they had slightly different declarations:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"public ReactiveCommand<Unit, TodoItem> Ok { get; }\npublic ReactiveCommand<Unit, Unit> Cancel { get; }\n")),(0,i.kt)("p",null,"The second type parameter to ",(0,i.kt)("inlineCode",{parentName:"p"},"ReactiveCommand")," specifies the type of result it produces when the command is executed. ",(0,i.kt)("inlineCode",{parentName:"p"},"Ok")," produces a ",(0,i.kt)("inlineCode",{parentName:"p"},"TodoItem")," while ",(0,i.kt)("inlineCode",{parentName:"p"},"Cancel")," produces a ",(0,i.kt)("inlineCode",{parentName:"p"},"Unit"),". ",(0,i.kt)("inlineCode",{parentName:"p"},"Unit")," is the reactive version of ",(0,i.kt)("inlineCode",{parentName:"p"},"void"),". It means the command produces no value."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://reactivex.io/documentation/operators/merge.html"},(0,i.kt)("inlineCode",{parentName:"a"},"Observable.Merge"))," combines the output from any number of obervables and merges them into a single observable stream. Because they're being merged into a single stream, they need to be of the same type. For this reason we call ",(0,i.kt)("inlineCode",{parentName:"p"},"vm.Cancel.Select(_ => (TodoItem)null)"),": this has the effect that every time the ",(0,i.kt)("inlineCode",{parentName:"p"},"Cancel")," observable produces a value we select a ",(0,i.kt)("inlineCode",{parentName:"p"},"null")," ",(0,i.kt)("inlineCode",{parentName:"p"},"TodoItem"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},".Take(1)\n")),(0,i.kt)("p",null,"We're only interested in the first click of either the OK or Cancel button; once one of the buttons are clicked we don't need to listen for any more clicks. ",(0,i.kt)("a",{parentName:"p",href:"https://reactivex.io/documentation/operators/take.html"},(0,i.kt)("inlineCode",{parentName:"a"},"Take(1)")),' means "just take the first value produced by the observable sequence".'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},".Subscribe(model =>\n{\n    if (model != null)\n    {\n        List.Items.Add(model);\n    }\n\n    Content = List;\n});\n")),(0,i.kt)("p",null,"Finally we subscribe to the result of the observable sequence. If the command resulted in a ",(0,i.kt)("inlineCode",{parentName:"p"},"model")," being produced ","(","i.e. OK was clicked",")"," then add this model to the list. We then set ",(0,i.kt)("inlineCode",{parentName:"p"},"Content")," back to ",(0,i.kt)("inlineCode",{parentName:"p"},"List"),' in order to display the list in the window and hide the "AddItemView".'),(0,i.kt)("h3",{id:"run-the-application-1"},"Run the application"),(0,i.kt)("img",{className:"center",src:l,alt:"The running application"}))}y.isMDXComponent=!0}}]);