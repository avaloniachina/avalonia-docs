"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[95412],{98791:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var t=a(85893),i=a(11151),o=a(95664);const r={id:"how-to-create-a-custom-page-transition",title:"\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c"},s="\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c",l={id:"guides/graphics-and-animation/page-transitions/how-to-create-a-custom-page-transition",title:"\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c",description:"\u672c\u6307\u5357\u5c06\u5411\u60a8\u5c55\u793a\u5982\u4f55\u901a\u8fc7\u5b9e\u73b0 IPageTransition \u63a5\u53e3\u6765\u521b\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c\u3002",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/guides/graphics-and-animation/page-transitions/how-to-create-a-custom-page-transition.md",sourceDirName:"guides/graphics-and-animation/page-transitions",slug:"/guides/graphics-and-animation/page-transitions/how-to-create-a-custom-page-transition",permalink:"/avalonia-docs/zh-Hans/docs/guides/graphics-and-animation/page-transitions/how-to-create-a-custom-page-transition",draft:!1,unlisted:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/i18n/zh-Hans/docusaurus-plugin-content-docs/current/guides/graphics-and-animation/page-transitions/how-to-create-a-custom-page-transition.md",tags:[],version:"current",frontMatter:{id:"how-to-create-a-custom-page-transition",title:"\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c"},sidebar:"documentationSidebar",previous:{title:"Page Transition Combinations",permalink:"/avalonia-docs/zh-Hans/docs/guides/graphics-and-animation/page-transitions/page-transition-combinations"},next:{title:"\u63a7\u4ef6\u7c7b\u578b",permalink:"/avalonia-docs/zh-Hans/docs/guides/custom-controls/types-of-control"}},c={},u=[{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2},{value:"\u66f4\u591a\u4fe1\u606f",id:"\u66f4\u591a\u4fe1\u606f",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,i.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c",children:"\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c"}),"\n",(0,t.jsxs)(e.p,{children:["\u672c\u6307\u5357\u5c06\u5411\u60a8\u5c55\u793a\u5982\u4f55\u901a\u8fc7\u5b9e\u73b0 ",(0,t.jsx)(e.code,{children:"IPageTransition"})," \u63a5\u53e3\u6765\u521b\u5efa\u81ea\u5df1\u7684\u81ea\u5b9a\u4e49\u9875\u9762\u8fc7\u6e21\u6548\u679c\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"\u8be5\u63a5\u53e3\u6709\u4e00\u4e2a\u9700\u8981\u5b9e\u73b0\u7684\u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:"public Task Start(Visual? from, Visual? to, bool forward, \n                                CancellationToken cancellationToken)\n{\n    // \u5728\u8fd9\u91cc\u8bbe\u7f6e\u8fc7\u6e21\u6548\u679c\u3002\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,t.jsx)(e.p,{children:"\u6b64\u793a\u4f8b\u5c06\u7f29\u5c0f\u65e7\u89c6\u56fe\uff0c\u7136\u540e\u5782\u76f4\u6253\u5f00\u65b0\u89c6\u56fe\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'using Avalonia.VisualTree;\n\npublic class CustomTransition : IPageTransition\n{\n    /// <summary>\n    /// \u521d\u59cb\u5316 <see cref="CustomTransition"/> \u7c7b\u7684\u65b0\u5b9e\u4f8b\u3002\n    /// </summary>\n    public CustomTransition()\n    {\n    }\n\n    /// <summary>\n    /// \u521d\u59cb\u5316 <see cref="CustomTransition"/> \u7c7b\u7684\u65b0\u5b9e\u4f8b\u3002\n    /// </summary>\n    /// <param name="duration">The duration of the animation.</param>\n    public CustomTransition(TimeSpan duration)\n    {\n        Duration = duration;\n    }\n\n    /// <summary>\n    /// \u83b7\u53d6\u6216\u8bbe\u7f6e\u52a8\u753b\u7684\u6301\u7eed\u65f6\u95f4\u3002\n    /// </summary>\n    public TimeSpan Duration { get; set; }\n\n    public async Task Start(Visual from, Visual to, bool forward, \n                                            CancellationToken cancellationToken)\n    {\n        if (cancellationToken.IsCancellationRequested)\n        {\n            return;\n        }\n\n        var tasks = new List<Task>();\n        var parent = GetVisualParent(from, to);\n        var scaleYProperty = ScaleTransform.ScaleYProperty;\n\n        if (from != null)\n        {\n            var animation = new Animation\n            {\n                FillMode = FillMode.Forward,\n                Children =\n                {\n                    new KeyFrame\n                    {\n                        Setters = { new Setter \n                        { Property = scaleYProperty, Value = 1d } },\n                        Cue = new Cue(0d)\n                    },\n                    new KeyFrame\n                    {\n                        Setters =\n                        {\n                            new Setter\n                            {\n                                Property = scaleYProperty,\n                                Value = 0d\n                            }\n                        },\n                        Cue = new Cue(1d)\n                    }\n                },\n                Duration = Duration\n            };\n            tasks.Add(animation.RunAsync(from, cancellationToken));\n        }\n\n        if (to != null)\n        {\n            to.IsVisible = true;\n            var animation = new Animation\n            {\n                FillMode = FillMode.Forward,\n                Children =\n                {\n                    new KeyFrame\n                    {\n                        Setters =\n                        {\n                            new Setter\n                            {\n                                Property = scaleYProperty,\n                                Value = 0d\n                            }\n                        },\n                        Cue = new Cue(0d)\n                    },\n                    new KeyFrame\n                    {\n                        Setters = { new Setter \n                        { \n                            Property = scaleYProperty, Value = 1d \n                        }},\n                        Cue = new Cue(1d)\n                    }\n                },\n                Duration = Duration\n            };\n            tasks.Add(animation.RunAsync(to, cancellationToken));\n        }\n\n        await Task.WhenAll(tasks);\n\n        if (from != null && !cancellationToken.IsCancellationRequested)\n        {\n            from.IsVisible = false;\n        }\n    }\n\n    /// <summary>\n    /// \u83b7\u53d6\u4e24\u4e2a\u63a7\u4ef6\u7684\u5171\u540c\u89c6\u89c9\u7236\u7ea7\u3002\n    /// </summary>\n    /// <param name="from">\u6e90\u63a7\u4ef6\u3002</param>\n    /// <param name="to">\u76ee\u6807\u63a7\u4ef6\u3002</param>\n    /// <returns>\u5171\u540c\u7684\u7236\u7ea7\u3002</returns>\n    /// <exception cref="ArgumentException">\n    /// \u4e24\u4e2a\u63a7\u4ef6\u6ca1\u6709\u5171\u540c\u7684\u7236\u7ea7\u3002\n    /// </exception>\n    /// <remarks>\n    /// \u4efb\u4f55\u4e00\u4e2a\u53c2\u6570\u53ef\u80fd\u4e3anull\uff0c\u4f46\u4e0d\u80fd\u90fd\u4e3anull\u3002\n    /// </remarks>\n    private static Visual GetVisualParent(Visual? from, Visual? to)\n    {\n        var p1 = (from ?? to)!.GetVisualParent();\n        var p2 = (to ?? from)!.GetVisualParent();\n\n        if (p1 != null && p2 != null && p1 != p2)\n        {\n            throw new ArgumentException(\n                                "Controls for PageSlide must have same parent.");\n        }\n\n        return p1 ?? throw new InvalidOperationException(\n                                                "Cannot determine visual parent.");\n    }\n}\n'})}),"\n",(0,t.jsx)("img",{src:o.Z,alt:""}),"\n",(0,t.jsx)(e.h2,{id:"\u66f4\u591a\u4fe1\u606f",children:"\u66f4\u591a\u4fe1\u606f"}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.p,{children:["\u6709\u5173\u6b64\u63a5\u53e3\u7684\u5b8c\u6574 API \u6587\u6863\uff0c\u8bf7\u53c2\u9605 ",(0,t.jsx)(e.a,{href:"http://reference.avaloniaui.net/api/Avalonia.Animation/IPageTransition/",children:"\u6b64\u5904"}),"."]})}),"\n",(0,t.jsx)(e.admonition,{type:"info",children:(0,t.jsxs)(e.p,{children:["\u5728 ",(0,t.jsx)(e.em,{children:"GitHub"})," \u4e0a\u67e5\u770b\u6e90\u4ee3\u7801 ",(0,t.jsx)(e.a,{href:"https://github.com/AvaloniaUI/Avalonia/blob/master/src/Avalonia.Base/Animation/IPageTransition.cs",children:(0,t.jsx)(e.code,{children:"IPageTransition.cs"})})]})})]})}function m(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},95664:(n,e,a)=>{a.d(e,{Z:()=>t});const t=a.p+"assets/images/TransitioningContentControl_03-07b8db42817a78df94e9c229b07b3557.webp"},11151:(n,e,a)=>{a.d(e,{Z:()=>s,a:()=>r});var t=a(67294);const i={},o=t.createContext(i);function r(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);