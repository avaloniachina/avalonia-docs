"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[63407],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>y});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=a.createContext({}),p=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=p(r),m=n,y=u["".concat(s,".").concat(m)]||u[m]||c[m]||o;return r?a.createElement(y,l(l({ref:t},d),{},{components:r})):a.createElement(y,l({ref:t},d))}));function y(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[u]="string"==typeof e?e:n,l[1]=i;for(var p=2;p<o;p++)l[p]=r[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},60920:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=r(87462),n=(r(67294),r(3905));const o={id:"how-to-create-advanced-custom-controls",title:"How To Create Advanced Custom Controls"},l="How To Create Advanced Custom Controls",i={unversionedId:"guides/custom-controls/how-to-create-advanced-custom-controls",id:"guides/custom-controls/how-to-create-advanced-custom-controls",title:"How To Create Advanced Custom Controls",description:"Stuff clipped from the custom control guide.",source:"@site/docs/guides/custom-controls/how-to-create-advanced-custom-controls.md",sourceDirName:"guides/custom-controls",slug:"/guides/custom-controls/how-to-create-advanced-custom-controls",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-advanced-custom-controls",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/guides/custom-controls/how-to-create-advanced-custom-controls.md",tags:[],version:"current",frontMatter:{id:"how-to-create-advanced-custom-controls",title:"How To Create Advanced Custom Controls"},sidebar:"documentationSidebar",previous:{title:"How To Create a Custom Flyout",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-a-custom-flyout"},next:{title:"How To Create Attached Properties",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-attached-properties"}},s={},p=[{value:"Using a <code>StyledProperty</code> on Another Class",id:"using-a-styledproperty-on-another-class",level:3},{value:"Readonly Properties",id:"readonly-properties",level:3},{value:"Attached Properties",id:"attached-properties",level:3},{value:"Direct AvaloniaProperties",id:"direct-avaloniaproperties",level:3},{value:"Using a DirectProperty on Another Class",id:"using-a-directproperty-on-another-class",level:3},{value:"When to use a Direct vs a Styled Property",id:"when-to-use-a-direct-vs-a-styled-property",level:3},{value:"DataValidation support",id:"datavalidation-support",level:3}],d={toc:p},u="wrapper";function c(e){let{components:t,...r}=e;return(0,n.kt)(u,(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"how-to-create-advanced-custom-controls"},"How To Create Advanced Custom Controls"),(0,n.kt)("p",null,"Stuff clipped from the custom control guide."),(0,n.kt)("p",null,"Here's how the ",(0,n.kt)("inlineCode",{parentName:"p"},"Border")," control defines its ",(0,n.kt)("inlineCode",{parentName:"p"},"Background")," property:"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty.Register")," method also accepts a number of other parameters:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"defaultValue"),": This gives the property a default value. Be sure to only pass value types and immutable types here as passing a reference type will cause the same object to be used on all instances on which the property is registered."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"inherits"),": Specified that the property's default value should come from the parent control."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"defaultBindingMode"),": The default binding mode for the property. Can be set to ",(0,n.kt)("inlineCode",{parentName:"li"},"OneWay"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"TwoWay"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"OneTime")," or ",(0,n.kt)("inlineCode",{parentName:"li"},"OneWayToSource"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"validate"),": A validation/coercion function of type ",(0,n.kt)("inlineCode",{parentName:"li"},"Func<TOwner, TValue, TValue>"),". The function accepts the instance of the class on which the property is being set and the value and returns the coerced value or throws an exception for an invalid value.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"A styled property is analogous to a ",(0,n.kt)("inlineCode",{parentName:"p"},"DependencyProperty")," in other XAML frameworks.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"The naming convention of the property and its backing AvaloniaProperty field is important. The name of the field is always the name of the property, with the suffix Property appended.")),(0,n.kt)("h3",{id:"using-a-styledproperty-on-another-class"},"Using a ",(0,n.kt)("inlineCode",{parentName:"h3"},"StyledProperty")," on Another Class"),(0,n.kt)("p",null,"Sometimes the property you want to add to your control already exists on another control, ",(0,n.kt)("inlineCode",{parentName:"p"},"Background")," being a good example. To register a property defined on another control, you call ",(0,n.kt)("inlineCode",{parentName:"p"},"StyledProperty.AddOwner"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"public static readonly StyledProperty<IBrush> BackgroundProperty =\n    Border.BackgroundProperty.AddOwner<Panel>();\n\npublic Brush Background\n{\n    get { return GetValue(BackgroundProperty); }\n    set { SetValue(BackgroundProperty, value); }\n}\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Note: Unlike WPF/UWP, a property must be registered on a class otherwise it cannot be set on an object of that class. This may change in future, however.")),(0,n.kt)("h3",{id:"readonly-properties"},"Readonly Properties"),(0,n.kt)("p",null,"To create a readonly property you use the ",(0,n.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty.RegisterDirect")," method. Here is how ",(0,n.kt)("inlineCode",{parentName:"p"},"Visual")," registers the readonly ",(0,n.kt)("inlineCode",{parentName:"p"},"Bounds")," property:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"public static readonly DirectProperty<Visual, Rect> BoundsProperty =\n    AvaloniaProperty.RegisterDirect<Visual, Rect>(\n        nameof(Bounds),\n        o => o.Bounds);\n\nprivate Rect _bounds;\n\npublic Rect Bounds\n{\n    get { return _bounds; }\n    private set { SetAndRaise(BoundsProperty, ref _bounds, value); }\n}\n")),(0,n.kt)("p",null,"As can be seen, readonly properties are stored as a field on the object. When registering the property, a getter is passed which is used to access the property value through ",(0,n.kt)("inlineCode",{parentName:"p"},"GetValue")," and then ",(0,n.kt)("inlineCode",{parentName:"p"},"SetAndRaise")," is used to notify listeners to changes to the property."),(0,n.kt)("h3",{id:"attached-properties"},"Attached Properties"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"../../concepts/attached-property"},"Attached properties")," are defined almost identically to styled properties except that they are registered using the ",(0,n.kt)("inlineCode",{parentName:"p"},"RegisterAttached")," method and their accessors are defined as static methods."),(0,n.kt)("p",null,"Here's how ",(0,n.kt)("inlineCode",{parentName:"p"},"Grid")," defines its ",(0,n.kt)("inlineCode",{parentName:"p"},"Grid.Column")," attached property:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},'public static readonly AttachedProperty<int> ColumnProperty =\n    AvaloniaProperty.RegisterAttached<Grid, Control, int>("Column");\n\npublic static int GetColumn(Control element)\n{\n    return element.GetValue(ColumnProperty);\n}\n\npublic static void SetColumn(Control element, int value)\n{\n    element.SetValue(ColumnProperty, value);\n}\n')),(0,n.kt)("h3",{id:"direct-avaloniaproperties"},"Direct AvaloniaProperties"),(0,n.kt)("p",null,"As its name suggests, ",(0,n.kt)("inlineCode",{parentName:"p"},"RegisterDirect")," isn't just used for registering readonly properties. You can also pass a ",(0,n.kt)("em",{parentName:"p"},"setter")," to ",(0,n.kt)("inlineCode",{parentName:"p"},"RegisterDirect")," to expose a standard C# property as a Avalonia property."),(0,n.kt)("p",null,"A ",(0,n.kt)("inlineCode",{parentName:"p"},"StyledProperty")," which is registered using ",(0,n.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty.Register")," maintains a prioritized list of values and bindings that allow styles to work. However, this is overkill for many properties, such as ",(0,n.kt)("inlineCode",{parentName:"p"},"ItemsControl.Items")," - this will never be styled and the overhead involved with styled properties is unnecessary."),(0,n.kt)("p",null,"Here is how ",(0,n.kt)("inlineCode",{parentName:"p"},"ItemsControl.Items")," is registered:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"public static readonly DirectProperty<ItemsControl, IEnumerable> ItemsProperty =\n    AvaloniaProperty.RegisterDirect<ItemsControl, IEnumerable>(\n        nameof(Items),\n        o => o.Items,\n        (o, v) => o.Items = v);\n\nprivate IEnumerable _items = new AvaloniaList<object>();\n\npublic IEnumerable Items\n{\n    get { return _items; }\n    set { SetAndRaise(ItemsProperty, ref _items, value); }\n}\n")),(0,n.kt)("p",null,"Direct properties are a lightweight version of styled properties that support the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"AvaloniaObject.GetValue"),(0,n.kt)("li",{parentName:"ul"},"AvaloniaObject.SetValue for non-readonly properties"),(0,n.kt)("li",{parentName:"ul"},"PropertyChanged"),(0,n.kt)("li",{parentName:"ul"},"Binding (only with LocalValue priority)"),(0,n.kt)("li",{parentName:"ul"},"GetObservable"),(0,n.kt)("li",{parentName:"ul"},"AddOwner"),(0,n.kt)("li",{parentName:"ul"},"Metadata")),(0,n.kt)("p",null,"They don't support the following:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Validation/Coercion (although this could be done in the property setter)"),(0,n.kt)("li",{parentName:"ul"},"Overriding default values."),(0,n.kt)("li",{parentName:"ul"},"Inherited values")),(0,n.kt)("h3",{id:"using-a-directproperty-on-another-class"},"Using a DirectProperty on Another Class"),(0,n.kt)("p",null,"In the same way that you can call ",(0,n.kt)("inlineCode",{parentName:"p"},"AddOwner")," on a styled property, you can also add an owner to a direct property. Because direct properties reference fields on the control, you must also add a field for the property:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"public static readonly DirectProperty<MyControl, IEnumerable> ItemsProperty =\n    ItemsControl.ItemsProperty.AddOwner<MyControl>(\n        o => o.Items,\n        (o, v) => o.Items = v);\n\nprivate IEnumerable _items = new AvaloniaList<object>();\n\npublic IEnumerable Items\n{\n    get { return _items; }\n    set { SetAndRaise(ItemsProperty, ref _items, value); }\n}\n")),(0,n.kt)("h3",{id:"when-to-use-a-direct-vs-a-styled-property"},"When to use a Direct vs a Styled Property"),(0,n.kt)("p",null,"In general you should declare your properties as styled properties. However, direct properties have advantages and disadvantages:"),(0,n.kt)("p",null,"Pros:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"No additional object is allocated per-instance for the property"),(0,n.kt)("li",{parentName:"ul"},"Property getter is a standard C# property getter"),(0,n.kt)("li",{parentName:"ul"},"Property setter is a standard C# property setter that raises an event."),(0,n.kt)("li",{parentName:"ul"},"You can add ",(0,n.kt)("a",{parentName:"li",href:"/avalonia-docs/docs/next/guides/development-guides/data-validation"},"data validation")," support")),(0,n.kt)("p",null,"Cons:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Cannot inherit value from parent control"),(0,n.kt)("li",{parentName:"ul"},"Cannot take advantage of Avalonia's styling system"),(0,n.kt)("li",{parentName:"ul"},"Property value is a field and as such is allocated whether the property is set on the object or not")),(0,n.kt)("p",null,"So use direct properties when you have the following requirements:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Property will not need to be styled"),(0,n.kt)("li",{parentName:"ul"},"Property will usually or always have a value")),(0,n.kt)("h3",{id:"datavalidation-support"},"DataValidation support"),(0,n.kt)("p",null,"If you want to allow a property to validate the data and show validation error messages, the property must be implemented as a ",(0,n.kt)("inlineCode",{parentName:"p"},"DirectProperty")," and validation support must be enabled (",(0,n.kt)("inlineCode",{parentName:"p"},"enableDataValidation: true"),")."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example of a property with DataValidation enabled")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-cs"},"public static readonly DirectProperty<MyControl, int> ValueProperty =\n    AvaloniaProperty.RegisterDirect<MyControl, int>(\n        nameof(Value),\n        o => o.Value,\n        (o, v) => o.Value = v, \n        enableDataValidation: true);\n")),(0,n.kt)("p",null,"If you want to ",(0,n.kt)("a",{parentName:"p",href:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-advanced-custom-controls#using-a-directproperty-on-another-class"},"re-use a direct property of another class")," you can also enable data validation. In this case use ",(0,n.kt)("inlineCode",{parentName:"p"},"AddOwnerWithDataValidation"),"."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example: TextBox.TextProperty property re-uses TextBlock.TextProperty but adds validation support")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-cs"},"public static readonly DirectProperty<TextBox, string?> TextProperty =\n    TextBlock.TextProperty.AddOwnerWithDataValidation<TextBox>(\n        o => o.Text,\n        (o, v) => o.Text = v,\n        defaultBindingMode: BindingMode.TwoWay,\n        enableDataValidation: true);\n")))}c.isMDXComponent=!0}}]);