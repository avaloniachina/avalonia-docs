"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[91836],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m=a.createContext({}),s=function(e){var t=a.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(m.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,m=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),u=r,h=d["".concat(m,".").concat(u)]||d[u]||p[u]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},35202:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const o={id:"how-to-create-attached-properties",title:"How To Create Attached Properties"},i="How To Create Attached Properties",l={unversionedId:"guides/custom-controls/how-to-create-attached-properties",id:"guides/custom-controls/how-to-create-attached-properties",title:"How To Create Attached Properties",description:"When you need more or let's say foreign properties on avalonia elements, then attached properties are the right thing to use. They can also be used to create so called behaviors to generally modify the hosted gui components. This can be utilized to bind a command to an event for instance.",source:"@site/docs/guides/custom-controls/how-to-create-attached-properties.md",sourceDirName:"guides/custom-controls",slug:"/guides/custom-controls/how-to-create-attached-properties",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-attached-properties",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/guides/custom-controls/how-to-create-attached-properties.md",tags:[],version:"current",frontMatter:{id:"how-to-create-attached-properties",title:"How To Create Attached Properties"},sidebar:"documentationSidebar",previous:{title:"How To Create Advanced Custom Controls",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-advanced-custom-controls"},next:{title:"How To Create Templated Controls",permalink:"/avalonia-docs/docs/next/guides/custom-controls/how-to-create-templated-controls"}},m={},s=[],c={toc:s},d="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-create-attached-properties"},"How To Create Attached Properties"),(0,r.kt)("p",null,"When you need more or let's say foreign properties on avalonia elements, then attached properties are the right thing to use. They can also be used to create so called behaviors to generally modify the hosted gui components. This can be utilized to bind a command to an event for instance."),(0,r.kt)("p",null,"Here we present an example of how to use a command in an MVVM compatible way and bind it to an event."),(0,r.kt)("p",null,"It may not be the ideal solution as there are projects such as ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/wieslawsoltes/AvaloniaBehaviors"},"Avalonia Behaviors")," where this is properly done. But it illustrates the following two learnings:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How to create attached properties in ",(0,r.kt)("em",{parentName:"li"},"Avalonia UI")),(0,r.kt)("li",{parentName:"ul"},"How to use them in a MVVM way.")),(0,r.kt)("p",null,"First we have to create our attached property. The method ",(0,r.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty.RegisterAttached")," is used for that purpose. Note that by convention the ",(0,r.kt)("strong",{parentName:"p"},"public static")," CLR-property for the attached property is named ",(0,r.kt)("em",{parentName:"p"},"XxxxProperty"),". Also note that by convention the name (the parameter) of the attaced property is ",(0,r.kt)("em",{parentName:"p"},"Xxxx")," without the ",(0,r.kt)("em",{parentName:"p"},"Property"),". And finally note that by convention one must provide two ",(0,r.kt)("strong",{parentName:"p"},"public static")," methods called ",(0,r.kt)("em",{parentName:"p"},"SetXxxx(element,value)")," and ",(0,r.kt)("em",{parentName:"p"},"GetXxxx(element)"),"."),(0,r.kt)("p",null,"This call ensures that the property has a type, an owner type and one where it may be used."),(0,r.kt)("p",null,"The verify method can be used to clean up a value that is being set. Either by returning the corrected value or discard the process by returning ",(0,r.kt)("inlineCode",{parentName:"p"},"AvaloniaProperty.UnsetValue"),". Or one can perform special tasks with the element that the property is hosted by. The getter and setter methods should always just set the value and never do anything beyond. In fact they will usually never be called as the Binding system will recognize the convention and set the properties directly where they are stored."),(0,r.kt)("p",null,"In this example file we create two attached properties that interact with each other: A ",(0,r.kt)("em",{parentName:"p"},"Command")," property and a ",(0,r.kt)("em",{parentName:"p"},"CommandParameter")," that is used by when invoking the command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'/// <summary>\n/// Container class for attached properties. Must inherit from <see cref="AvaloniaObject"/>.\n/// </summary>\npublic class DoubleTappedBehav : AvaloniaObject\n{\n    static DoubleTappedBehav()\n    {\n        CommandProperty.Changed.Subscribe(x => HandleCommandChanged(x.Sender, x.NewValue.GetValueOrDefault<ICommand>()));\n    }\n\n    /// <summary>\n    /// Identifies the <seealso cref="CommandProperty"/> avalonia attached property.\n    /// </summary>\n    /// <value>Provide an <see cref="ICommand"/> derived object or binding.</value>\n    public static readonly AttachedProperty<ICommand> CommandProperty = AvaloniaProperty.RegisterAttached<DoubleTappedBehav, Interactive, ICommand>(\n        "Command", default(ICommand), false, BindingMode.OneTime);\n\n    /// <summary>\n    /// Identifies the <seealso cref="CommandParameterProperty"/> avalonia attached property.\n    /// Use this as the parameter for the <see cref="CommandProperty"/>.\n    /// </summary>\n    /// <value>Any value of type <see cref="object"/>.</value>\n    public static readonly AttachedProperty<object> CommandParameterProperty = AvaloniaProperty.RegisterAttached<DoubleTappedBehav, Interactive, object>(\n        "CommandParameter", default(object), false, BindingMode.OneWay, null);\n\n\n    /// <summary>\n    /// <see cref="CommandProperty"/> changed event handler.\n    /// </summary>\n    private static void HandleCommandChanged(IAvaloniaObject element, ICommand commandValue)\n    {\n        if (element is Interactive interactElem)\n        {\n            if (commandValue != null)\n            {\n                // Add non-null value\n                interactElem.AddHandler(InputElement.DoubleTappedEvent, Handler);\n            }\n            else\n            {\n                // remove prev value\n                interactElem.RemoveHandler(InputElement.DoubleTappedEvent, Handler);\n            }\n        }\n\n        // local handler fcn\n        static void Handler(object s, RoutedEventArgs e)\n        {\n            if (s is Interactive interactElem)\n            {\n                // This is how we get the parameter off of the gui element.\n                object commandParameter = interactElem.GetValue(CommandParameterProperty);\n                ICommand commandValue = interactElem.GetValue(CommandProperty);\n                if (commandValue?.CanExecute(commandParameter) == true)\n                {\n                    commandValue.Execute(commandParameter);\n                }\n            }\n        }\n    }\n\n\n    /// <summary>\n    /// Accessor for Attached property <see cref="CommandProperty"/>.\n    /// </summary>\n    public static void SetCommand(AvaloniaObject element, ICommand commandValue)\n    {\n        element.SetValue(CommandProperty, commandValue);\n    }\n\n    /// <summary>\n    /// Accessor for Attached property <see cref="CommandProperty"/>.\n    /// </summary>\n    public static ICommand GetCommand(AvaloniaObject element)\n    {\n        return element.GetValue(CommandProperty);\n    }\n\n    /// <summary>\n    /// Accessor for Attached property <see cref="CommandParameterProperty"/>.\n    /// </summary>\n    public static void SetCommandParameter(AvaloniaObject element, object parameter)\n    {\n        element.SetValue(CommandParameterProperty, parameter);\n    }\n\n    /// <summary>\n    /// Accessor for Attached property <see cref="CommandParameterProperty"/>.\n    /// </summary>\n    public static object GetCommandParameter(AvaloniaObject element)\n    {\n        return element.GetValue(CommandParameterProperty);\n    }\n}\n\n')),(0,r.kt)("p",null,"In the verify method we utilize the routed event system to attach a new handler. Note that the handler should be detached, again. The value of the property is requested by the normal program mechanisms using ",(0,r.kt)("inlineCode",{parentName:"p"},"GetValue()")," method."),(0,r.kt)("p",null,"This example UI shows how to use the attached property. After making the namespace known to the XAML compiler it can be used by qualifying it with a dot. Then bindings can be used."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-markup"},'<UserControl xmlns="https://github.com/avaloniaui"\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n             xmlns:loc="clr-namespace:MyApp.Behaviors"\n             x:Class="MyApp.Views.TestView">\n    <ListBox ItemsSource="{Binding Accounts}"\n             SelectedIndex="{Binding SelectedAccountIdx, Mode=TwoWay}"\n             loc:DoubleTappedBehav.Command="{Binding EditCommand}"\n             loc:DoubleTappedBehav.CommandParameter="test77"\n             >\n      <ListBox.ItemTemplate>\n        <DataTemplate>\n          <TextBlock Text="{Binding }" />          \n        </DataTemplate>\n      </ListBox.ItemTemplate>\n    </ListBox>\n</UserControl>\n')),(0,r.kt)("p",null,"Although the ",(0,r.kt)("inlineCode",{parentName:"p"},"CommandParameter")," only uses a static value, it can be used with binding, too. When used with this view model, the ",(0,r.kt)("inlineCode",{parentName:"p"},"EditCommandExecuted")," will run once a double click happens."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public class TestViewModel : ReactiveObject\n{\n    public ObservableCollection<Profile> Accounts { get; } = new ObservableCollection<Profile>();\n\n    public ReactiveCommand<object, Unit> EditCommand { get; set; }\n\n    public TestViewModel()\n    {\n        EditCommand = ReactiveCommand.CreateFromTask<object, Unit>(EditCommandExecuted);\n    }\n\n    private async Task<Unit> EditCommandExecuted(object p)\n    {\n        // p contains "test77"\n\n        return Unit.Default;\n    }\n}\n')))}p.isMDXComponent=!0}}]);