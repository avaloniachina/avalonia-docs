"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[20821],{13809:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>h});var t=i(85893),o=i(11151),a=i(87582),l=i(15016);const s={description:"TUTORIALS - Music Store App"},d="Open a Dialog",r={id:"tutorials/music-store-app/opening-a-dialog",title:"Open a Dialog",description:"TUTORIALS - Music Store App",source:"@site/docs/tutorials/music-store-app/opening-a-dialog.md",sourceDirName:"tutorials/music-store-app",slug:"/tutorials/music-store-app/opening-a-dialog",permalink:"/avalonia-docs/docs/tutorials/music-store-app/opening-a-dialog",draft:!1,unlisted:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/tutorials/music-store-app/opening-a-dialog.md",tags:[],version:"current",frontMatter:{description:"TUTORIALS - Music Store App"},sidebar:"documentationSidebar",previous:{title:"Button Command",permalink:"/avalonia-docs/docs/tutorials/music-store-app/button-command"},next:{title:"Add Dialog Content",permalink:"/avalonia-docs/docs/tutorials/music-store-app/add-content-to-dialog"}},c={},h=[{value:"Add a New Dialog Window",id:"add-a-new-dialog-window",level:2},{value:"Dialog Window Styling",id:"dialog-window-styling",level:2},{value:"Dialog Input and Output",id:"dialog-input-and-output",level:2},{value:"Show Dialog",id:"show-dialog",level:2},{value:"Dialog Position and Size",id:"dialog-position-and-size",level:2}];function w(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"open-a-dialog",children:"Open a Dialog"}),"\n",(0,t.jsxs)(n.p,{children:["On this page you will learn how to use ",(0,t.jsx)(n.em,{children:"ReactiveUI"})," to manage another window in your app. The new window will eventually contain a search facility, and a button to add one of the album covers found to a list in the main window.  This new window will be opened as a dialog - that is it will prevent activity in the main window while it is showing."]}),"\n",(0,t.jsx)(n.h2,{id:"add-a-new-dialog-window",children:"Add a New Dialog Window"}),"\n",(0,t.jsxs)(n.p,{children:["There is nothing special about a window view file that makes it into a dialog; that is up to the way in which the window is controlled by the app; and you will use ",(0,t.jsx)(n.em,{children:"ReactiveUI"})," to manage this. So the first step is to create a new window for the app."]}),"\n",(0,t.jsx)(n.p,{children:"To create a new window, follow this procedure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Stop the app if it is still running."}),"\n",(0,t.jsxs)(n.li,{children:["In the solution explorer, right-click the ",(0,t.jsx)(n.strong,{children:"/Views"})," folder and then click ",(0,t.jsx)(n.strong,{children:"Add"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Avalonia Window"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"When prompted for the name, type 'MusicStoreWindow'"}),"\n",(0,t.jsx)(n.li,{children:"Press enter."}),"\n"]}),"\n",(0,t.jsx)("p",{children:(0,t.jsx)("img",{className:"image-medium-zoom",src:a.Z,alt:""})}),"\n",(0,t.jsx)(n.h2,{id:"dialog-window-styling",children:"Dialog Window Styling"}),"\n",(0,t.jsx)(n.p,{children:"To style the new dialog window so that it matches the main window, follow this procedure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Locate and open the ",(0,t.jsx)(n.strong,{children:"MusicStoreWindow.axaml"})," file."]}),"\n",(0,t.jsx)(n.li,{children:"Change this code as follows to add the acrylic blur background, extended into the title bar (as before) as shown:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-markup",children:'<Window xmlns="https://github.com/avaloniaui"\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\n        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\n        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"\n        x:Class="Avalonia.MusicStore.Views.MusicStoreWindow"\n        Title="MusicStoreWindow"\n        TransparencyLevelHint="AcrylicBlur"\n        ExtendClientAreaToDecorationsHint="True">\n    <Panel>\n        <ExperimentalAcrylicBorder IsHitTestVisible="False">\n            <ExperimentalAcrylicBorder.Material>\n                <ExperimentalAcrylicMaterial\n                    BackgroundSource="Digger"\n                    TintColor="Black"\n                    TintOpacity="1"\n                    MaterialOpacity="0.65" />\n            </ExperimentalAcrylicBorder.Material>\n        </ExperimentalAcrylicBorder>\n\n        <Panel Margin="40">\n\n        </Panel>\n    </Panel>\n</Window>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"dialog-input-and-output",children:"Dialog Input and Output"}),"\n",(0,t.jsx)(n.p,{children:"The application logic for the dialog will be controlled by its own view model. This will be created and linked to the dialog window view whenever the dialog is to be shown."}),"\n",(0,t.jsx)(n.p,{children:"Similarly, the result of the users interaction with the dialog will eventually have to be passed back to the application logic for the main window for processing."}),"\n",(0,t.jsx)(n.p,{children:"At this stage you will create two empty view model classes to act as placeholders for the dialog view model, and the dialog return (selected album) object. To create these view models, follow this procedure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["In the solution explorer, right-click the ",(0,t.jsx)(n.strong,{children:"/ViewModels"})," folder and then click ",(0,t.jsx)(n.strong,{children:"Add"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Class"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Name the class 'MusicStoreViewModel' and click ",(0,t.jsx)(n.strong,{children:"Add"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Right-click again the ",(0,t.jsx)(n.strong,{children:"/ViewModels"})," folder and then click ",(0,t.jsx)(n.strong,{children:"Add"})," a second time."]}),"\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Class"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Name the class 'AlbumViewModel' and click ",(0,t.jsx)(n.strong,{children:"Add"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"show-dialog",children:"Show Dialog"}),"\n",(0,t.jsx)(n.p,{children:"Now you have a new window for the dialog, and some view model classes for its interaction; there are two steps to create the dialog interaction:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The main window view model starts the interaction."}),"\n",(0,t.jsx)(n.li,{children:"The main window view knows how to start the interaction."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Firstly, to alter the main window view model code so it starts the interaction to show the dialog, follow this procedure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Locate and open the ",(0,t.jsx)(n.strong,{children:"MainWindowViewModel.cs"})," file."]}),"\n",(0,t.jsx)(n.li,{children:"Add a declaration for the interaction with the new dialog window, as shown:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public Interaction<MusicStoreViewModel, AlbumViewModel?> ShowDialog { get; }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Alter the constructor code to create the reactive command from a asynchronous task, as shown:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"using System;\nusing System.Collections.Generic;\nusing System.Reactive.Linq;\nusing System.Text;\nusing System.Windows.Input;\nusing ReactiveUI;\n\nnamespace Avalonia.MusicStore.ViewModels\n{\n    public class MainWindowViewModel : ViewModelBase\n    {\n        public MainWindowViewModel()\n        {\n            ShowDialog = new Interaction<MusicStoreViewModel, AlbumViewModel?>();\n\n            BuyMusicCommand = ReactiveCommand.CreateFromTask(async () =>\n            {\n                var store = new MusicStoreViewModel();\n\n                var result = await ShowDialog.Handle(store);\n            });\n        }\n\n        public ICommand BuyMusicCommand { get; }\n\n        public Interaction<MusicStoreViewModel, AlbumViewModel?> ShowDialog { get; }\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["At this point, the code for the interaction is still incomplete. If you attempt to run the app now and click the icon button, you will get an exception of class ",(0,t.jsx)(n.code,{children:"ReactiveUI.UnhandledInteractionException"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Your next step is to make sure that the main window view knows how to start the interaction. This is implemented in the code-behind file for the main window view, and uses some features of the ",(0,t.jsx)(n.em,{children:"ReactiveUI"})," framework.  Follow this procedure:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Locate and open the code-behind ",(0,t.jsx)(n.strong,{children:"MainWindow.axaml.cs"})," file. (You may need to expand the ",(0,t.jsx)(n.strong,{children:"MainWindow.axaml"})," file to find it.)"]}),"\n",(0,t.jsxs)(n.li,{children:["Alter the class wo that it inherits from ",(0,t.jsx)(n.code,{children:"ReactiveWindow<MainWindowViewModel>"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Add the ",(0,t.jsx)(n.code,{children:"DoShowDialogAsync"})," method as follows:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"private async Task DoShowDialogAsync(InteractionContext<MusicStoreViewModel,\n                                        AlbumViewModel?> interaction)\n{\n     var dialog = new MusicStoreWindow();\n     dialog.DataContext = interaction.Input;\n\n     var result = await dialog.ShowDialog<AlbumViewModel?>(this);\n     interaction.SetOutput(result);\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Add the following code to the end of the constructor:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"this.WhenActivated(action => \n         action(ViewModel!.ShowDialog.RegisterHandler(DoShowDialogAsync)));\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This means that whenever the main window view is activated, the ",(0,t.jsx)(n.code,{children:"DoShowDialogAsync"})," handler is registered. The action is disposable, so that ",(0,t.jsx)(n.em,{children:"ReactiveUI"})," can clean up the registration when  the main window view is not on the screen."]}),"\n",(0,t.jsx)(n.p,{children:"Your whole file should now look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"using Avalonia.ReactiveUI;\nusing AvaloniaApplication11.ViewModels;\nusing ReactiveUI;\nusing System.Threading.Tasks;\n\nnamespace AvaloniaApplication11.Views\n{\n    public partial class MainWindow : ReactiveWindow<MainWindowViewModel>\n    {\n        public MainWindow()\n        {\n            InitializeComponent();\n            this.WhenActivated(action =>\n                action(ViewModel!.ShowDialog.RegisterHandler(DoShowDialogAsync)));\n        }\n\n        private async Task DoShowDialogAsync(InteractionContext<MusicStoreViewModel, \n                                                AlbumViewModel?> interaction)\n        {\n            var dialog = new MusicStoreWindow();\n            dialog.DataContext = interaction.Input;\n\n            var result = await dialog.ShowDialog<AlbumViewModel?>(this);\n            interaction.SetOutput(result);\n        }\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Debug"})," to compile and run the project."]}),"\n",(0,t.jsx)(n.li,{children:"Click the icon button."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It all works - but the dialog window opens at the same size as the main window, and offset from it."}),"\n",(0,t.jsx)(n.h2,{id:"dialog-position-and-size",children:"Dialog Position and Size"}),"\n",(0,t.jsx)(n.p,{children:"In the last step here, you will make the dialog smaller that the main window, and open centered on it. You will also make the main window open in the center of the user's screen."}),"\n",(0,t.jsx)(n.p,{children:"Follow this procedure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Stop the app if it is still running."}),"\n",(0,t.jsxs)(n.li,{children:["Locate and open the ",(0,t.jsx)(n.strong,{children:"MainWindow.axaml"})," file."]}),"\n",(0,t.jsxs)(n.li,{children:["Add an attribute to the ",(0,t.jsx)(n.code,{children:"<Window>"})," element to set the start-up position:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<Window ...\n    WindowStartupLocation="CenterScreen">\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Locate and open the ",(0,t.jsx)(n.strong,{children:"MusicStoreWindow.axaml"})," file."]}),"\n",(0,t.jsx)(n.li,{children:"Add attributes for the width and height of the dialog, set at 1000 and 550 respectively."}),"\n",(0,t.jsxs)(n.li,{children:["Add the start-up position attribute set to ",(0,t.jsx)(n.code,{children:"CenterOwner"}),", as shown:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'<Window ...\n    Width="1000" Height="550"\n    WindowStartupLocation="CenterOwner">\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Click ",(0,t.jsx)(n.strong,{children:"Debug"})," to compile and run the project."]}),"\n",(0,t.jsx)(n.li,{children:"Click the icon button."}),"\n"]}),"\n",(0,t.jsx)("p",{children:(0,t.jsx)("img",{className:"image-medium-zoom",src:l.Z,alt:""})}),"\n",(0,t.jsx)(n.p,{children:"The dialog window is now opened centered inside the main window."}),"\n",(0,t.jsx)(n.p,{children:"On the next page, you will learn how to add some content to the dialog window to represent a search for albums, and present the results."})]})}function u(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(w,{...e})}):w(e)}},87582:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/add-window-a2a520bf9bfef8e3144d15a36f604bdf.png"},15016:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/dialog-opened-b156cc3067a7c7353e592f5f075c41a3.png"},11151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>l});var t=i(67294);const o={},a=t.createContext(o);function l(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);