"use strict";(self.webpackChunkavalonia_docs=self.webpackChunkavalonia_docs||[]).push([[20403],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),m=s(n),c=i,k=m["".concat(p,".").concat(c)]||m[c]||u[c]||l;return n?a.createElement(k,o(o({ref:t},d),{},{components:n})):a.createElement(k,o({ref:t},d))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,o=new Array(l);o[0]=c;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[m]="string"==typeof e?e:i,o[1]=r;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},30209:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var a=n(87462),i=(n(67294),n(3905));const l={id:"upgrade-from-0.10",title:"Upgrading from 0.10"},o=void 0,r={unversionedId:"stay-up-to-date/upgrade-from-0.10",id:"stay-up-to-date/upgrade-from-0.10",title:"Upgrading from 0.10",description:"Avalonia 11 introduces a number of breaking changes from 0.10. The following guide converse the most commonly-encountered changes and gives solutions for them.",source:"@site/docs/stay-up-to-date/upgrade-from-0.10.md",sourceDirName:"stay-up-to-date",slug:"/stay-up-to-date/upgrade-from-0.10",permalink:"/avalonia-docs/docs/next/stay-up-to-date/upgrade-from-0.10",draft:!1,editUrl:"https://github.com/AvaloniaUI/avalonia-docs/tree/main/docs/stay-up-to-date/upgrade-from-0.10.md",tags:[],version:"current",frontMatter:{id:"upgrade-from-0.10",title:"Upgrading from 0.10"},sidebar:"documentationSidebar",previous:{title:"Stay Up-To-Date",permalink:"/avalonia-docs/docs/next/stay-up-to-date/"},next:{title:"What's new",permalink:"/avalonia-docs/docs/next/stay-up-to-date/whats-new"}},p={},s=[{value:"Updating the project",id:"updating-the-project",level:2},{value:"Theme Handling",id:"theme-handling",level:2},{value:"Theme Dictionary and Theme Variant",id:"theme-dictionary-and-theme-variant",level:3},{value:"System.Reactive/Observables",id:"systemreactiveobservables",level:2},{value:"Updating Interfaces",id:"updating-interfaces",level:2},{value:"Optional, but recommended:",id:"optional-but-recommended",level:3},{value:"Views",id:"views",level:2},{value:"ItemsControl",id:"itemscontrol",level:2},{value:"Classes",id:"classes",level:2},{value:"Windows",id:"windows",level:2},{value:"AssetLoader",id:"assetloader",level:2},{value:"OnPropertyChanged",id:"onpropertychanged",level:2},{value:"Events",id:"events",level:2},{value:"Layout",id:"layout",level:2},{value:"Focus",id:"focus",level:2},{value:"Visual Tree",id:"visual-tree",level:2},{value:"Rendering",id:"rendering",level:2},{value:"Locator",id:"locator",level:2},{value:"Miscellaneous/Advanced Scenarios",id:"miscellaneousadvanced-scenarios",level:2}],d={toc:s},m="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Avalonia 11 introduces a number of breaking changes from 0.10. The following guide converse the most commonly-encountered changes and gives solutions for them."),(0,i.kt)("h2",{id:"updating-the-project"},"Updating the project"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Update the Avalonia packages to 11.x"),(0,i.kt)("li",{parentName:"ol"},"Themes are no longer included in the Avalonia.Desktop package, so you will need to add a package reference to either",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Avalonia.Themes.Fluent")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Avalonia.Themes.Simple")))),(0,i.kt)("li",{parentName:"ol"},"Remove the package reference to ",(0,i.kt)("inlineCode",{parentName:"li"},"XamlNameReferenceGenerator")," - Avalonia now includes an inbuilt generator by default"),(0,i.kt)("li",{parentName:"ol"},"If necessary, update the ",(0,i.kt)("inlineCode",{parentName:"li"},"<LangVersion>")," to at least 9 in order to be able to use init-only properties"),(0,i.kt)("li",{parentName:"ol"},"If you want the same fonts as in 0.10, also include ",(0,i.kt)("inlineCode",{parentName:"li"},"Avalonia.Fonts.Inter")," package and add ",(0,i.kt)("inlineCode",{parentName:"li"},".WithInterFont()")," to the app builder. By default, 11.0 doesn't include any custom fonts.")),(0,i.kt)("h2",{id:"theme-handling"},"Theme Handling"),(0,i.kt)("p",null,"In v0.10, the theme is specified directly inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"Application.Styles")," tag in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Application.axaml")," file. An example of this is shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Application.Styles>\n    <FluentTheme Mode="Light"/>\n</Application.Styles>\n')),(0,i.kt)("p",null,"In this example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"Mode")," attribute of the ",(0,i.kt)("inlineCode",{parentName:"p"},"FluentTheme"),' tag is used to specify the theme mode, which can be either "Light" or "Dark".'),(0,i.kt)("p",null,"Theme management is improved by introducing a new attribute to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Application")," tag: ",(0,i.kt)("inlineCode",{parentName:"p"},"RequestedThemeVariant"),'. This new attribute is used to set the theme of your application, overriding the system\'s current theme if specified. If you want to follow the system\'s current theme, you can set it to "Default". Other available options are "Dark" and "Light".'),(0,i.kt)("p",null,"An example of how this attribute is used is shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<Application xmlns="https://github.com/avaloniaui"\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\n             x:Class="ILoveAvaloniaUI.App"\n             xmlns:local="using:ILoveAvaloniaUI"\n             RequestedThemeVariant="Default">\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"FluentTheme")," tag no longer requires the ",(0,i.kt)("inlineCode",{parentName:"p"},"Mode")," attribute and can be left empty."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<Application.Styles>\n    <FluentTheme />\n</Application.Styles>\n")),(0,i.kt)("h3",{id:"theme-dictionary-and-theme-variant"},"Theme Dictionary and Theme Variant"),(0,i.kt)("p",null,"The method, ",(0,i.kt)("inlineCode",{parentName:"p"},"Styles.TryGetResource")," method now requires a nullable ",(0,i.kt)("inlineCode",{parentName:"p"},"ThemeVariant")," parameter as per PR ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/8166"},"#8166"),". This allows users to specify ",(0,i.kt)("inlineCode",{parentName:"p"},"Light"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Dark"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"Default")),(0,i.kt)("p",null,"Using ",(0,i.kt)("inlineCode",{parentName:"p"},"ThemeVariant.Default")," as the key marks a specific theme dictionary as a fallback in case the theme variant or resource key is not found in other theme dictionaries."),(0,i.kt)("p",null,"In addition to the built-in values of ",(0,i.kt)("inlineCode",{parentName:"p"},"Light"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Dark"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"Default"),", any object value can be used as a key (",(0,i.kt)("em",{parentName:"p"},"since it's wrapped in the ",(0,i.kt)("inlineCode",{parentName:"em"},"ThemeVariant(object key)")," structure"),"). ",(0,i.kt)("inlineCode",{parentName:"p"},"{x:Static}")," markup extension can also be used here if a developer wants to define multiple custom themes as static properties and reference them from the XAML code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},"// Before\nbool TryGetResource(object key, out object? value)\n\n// Avalonia v11\nbool TryGetResource(object key, ThemeVariant? theme, out object? value)\n")),(0,i.kt)("h2",{id:"systemreactiveobservables"},"System.Reactive/Observables"),(0,i.kt)("p",null,"Avalonia no longer has a dependency on ",(0,i.kt)("inlineCode",{parentName:"p"},"System.Reactive"),". If you're using reactive features, add a package reference to ",(0,i.kt)("inlineCode",{parentName:"p"},"System.Reactive")," to your project."),(0,i.kt)("p",null,"If you don't need the whole of ",(0,i.kt)("inlineCode",{parentName:"p"},"System.Reactive")," but just want to make a simple subscription to an ",(0,i.kt)("inlineCode",{parentName:"p"},"IObservable<T>")," you can use the utility class ",(0,i.kt)("inlineCode",{parentName:"p"},"AnonymousObserver<T>")," provided by Avalonia, for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"observable.Subscribe(new AnonymousObserver<string>(() => { /* Code to execute when the observable changes. */ }));\n")),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/9749"},"#9749"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/10105"},"#10105")," for more information."),(0,i.kt)("h2",{id:"updating-interfaces"},"Updating Interfaces"),(0,i.kt)("p",null,"Many interfaces have been removed in Avalonia 11. You should be able to do a global find/replace to replace each of the follow interfaces with its concrete type:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IAvaloniaObject")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"AvaloniaObject")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IBitmap")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Bitmap")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IContentPresenter")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ContentPresenter")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IControl")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Control")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IInteractive")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Interactive")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IItemsPresenter")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ItemsPresenter")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ILayoutable")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Layoutable")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IPanel")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Panel")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IStyledElement")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"StyledElement")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ITemplatedControl")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"TemplatedControl")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IVisual")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Visual"))),(0,i.kt)("p",null,"If you have your own interfaces that derive from one of these interfaces you'll need to remove the interface base, and do a cast to the concrete class at the point of usage."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/9553"},"#9553"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/11495"},"#11495")," for more information."),(0,i.kt)("h3",{id:"optional-but-recommended"},"Optional, but recommended:"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"IStyleable")," interface is now deprecated. In Avalonia 0.10.x, to override a control's style key you implemented ",(0,i.kt)("inlineCode",{parentName:"p"},"IStyleable")," and added an explicit interface implementation for ",(0,i.kt)("inlineCode",{parentName:"p"},"StyleKey"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"class MyButton : Button, IStyleable\n{\n    Type IStyleable.StyleKey => typeof(Button);\n}\n")),(0,i.kt)("p",null,"In Avalonia 11, the ",(0,i.kt)("inlineCode",{parentName:"p"},"IStyleable")," reference will give a deprecated warning. The following should be used instead:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"class MyButton : Button\n{\n    protected override Type StyleKeyOverride => typeof(Button);\n}\n")),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/11380"},"#11380")," for more information."),(0,i.kt)("h2",{id:"views"},"Views"),(0,i.kt)("p",null,"Views that are in the form of a ",(0,i.kt)("inlineCode",{parentName:"p"},".axaml"),"/",(0,i.kt)("inlineCode",{parentName:"p"},".axaml.cs")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},".xaml"),"/",(0,i.kt)("inlineCode",{parentName:"p"},".xaml.cs"),") pair now have auto-generated C# code. To facilitate this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Make the class in the .cs file ",(0,i.kt)("inlineCode",{parentName:"li"},"partial")),(0,i.kt)("li",{parentName:"ul"},"Remove the ",(0,i.kt)("inlineCode",{parentName:"li"},"private void InitializeComponent()")," method"),(0,i.kt)("li",{parentName:"ul"},"Do ",(0,i.kt)("strong",{parentName:"li"},"NOT")," remove the call to ",(0,i.kt)("inlineCode",{parentName:"li"},"InitializeComponent()")," in the constructor: this method is now a generated method and still needs to be called"),(0,i.kt)("li",{parentName:"ul"},"Remove the ",(0,i.kt)("inlineCode",{parentName:"li"},"this.AttachDevTools()")," call from the constructor - ",(0,i.kt)("inlineCode",{parentName:"li"},"InitializeComponent")," now has a parameter which controls whether DevTools is attached in debug mode whose default is ",(0,i.kt)("inlineCode",{parentName:"li"},"true"))),(0,i.kt)("p",null,"Previously, to find a named control declared in the XAML file, a call to ",(0,i.kt)("inlineCode",{parentName:"p"},"this.FindControl<T>(string name)")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"this.GetControl<T>(string name)")," was needed. This is now unnecessary - controls in the XAML file with a ",(0,i.kt)("inlineCode",{parentName:"p"},"Name")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"x:Name")," attribute will automatically cause a field to be generated in the class to access the named control (as in WPF/UWP etc)."),(0,i.kt)("p",null,"Note, this source generator is available for C# only. For F# nothing was changed."),(0,i.kt)("h2",{id:"itemscontrol"},"ItemsControl"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ItemsControl")," and derived classes such as ",(0,i.kt)("inlineCode",{parentName:"p"},"ListBox")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ComboBox")," now have both an ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," property and an ",(0,i.kt)("inlineCode",{parentName:"p"},"ItemsSource")," as in WPF/UWP."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Items")," is a readonly collection property that is pre-populated, and ",(0,i.kt)("inlineCode",{parentName:"p"},"ItemsSource")," is the read/write version that has a default value of null."),(0,i.kt)("p",null,"Replace any bindings to ",(0,i.kt)("inlineCode",{parentName:"p"},"Items")," with a binding to ",(0,i.kt)("inlineCode",{parentName:"p"},"ItemsSource"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<ListBox Items="{Binding Items}">\n')),(0,i.kt)("p",null,"Becomes"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<ListBox ItemsSource="{Binding Items}">\n')),(0,i.kt)("p",null,"In addition:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ListBox.VirtualizationMode")," has been removed, the virtualization mode is changed by changing the ",(0,i.kt)("inlineCode",{parentName:"li"},"ItemsPanel"),":",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"To disable virtualization use a ",(0,i.kt)("inlineCode",{parentName:"li"},"StackPanel"),"."),(0,i.kt)("li",{parentName:"ul"},"To enable virtualization use a ",(0,i.kt)("inlineCode",{parentName:"li"},"VirtualizingStackPanel"),"."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Carousel.IsVirtualizing"),' has been removed, there is now only a "virtualizing" mode for ',(0,i.kt)("inlineCode",{parentName:"li"},"Carousel")),(0,i.kt)("li",{parentName:"ul"},"Item container lookup was moved to ",(0,i.kt)("inlineCode",{parentName:"li"},"ItemsControl")," as in UWP (old methods are left on ItemContainerGenerator marked with ","[Obsolete]","):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ItemsControl.ContainerFromIndex(object item)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ItemsControl.IndexFromContainer(Control container)")))),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"Items")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"ItemTemplate")," properties on ",(0,i.kt)("inlineCode",{parentName:"li"},"ItemsPresenter")," have been removed. The template bindings to these properties in control templates can simply be removed")),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/10590"},"#10590"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/10827"},"#10827")," for more information."),(0,i.kt)("h2",{id:"classes"},"Classes"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"StyledElement.Classes")," is now a readonly property. When used in an object initializer, code which did the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'var c = new Control\n{\n    Classes = new Classes("foo", "bar"),\n};\n')),(0,i.kt)("p",null,"Should be changed to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'var c = new Control\n{\n    Classes = { "foo", "bar" },\n};\n')),(0,i.kt)("p",null,"To manipulate a ",(0,i.kt)("inlineCode",{parentName:"p"},"Classes")," collection outside of an object initializer use the standard ",(0,i.kt)("inlineCode",{parentName:"p"},"IList<string>")," methods."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/11013"},"#11013")," for more information."),(0,i.kt)("h2",{id:"windows"},"Windows"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"TopLEvel.PlatformImpl")," API is no longer available for controls such as ",(0,i.kt)("inlineCode",{parentName:"p"},"Window"),". The relevant methods have been moved to ",(0,i.kt)("inlineCode",{parentName:"p"},"TopLevel"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"WindowBase")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Window")," itself:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.PlatformImpl.Handle")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"window.TryGetPlatformHandle()")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.PlatformImpl.BeginMove(e)")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"window.BeginMove()")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"window.PlatformImpl.Resized")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"window.Resized"))),(0,i.kt)("h2",{id:"assetloader"},"AssetLoader"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"IAssetLoader")," interface is no longer available. Use the static ",(0,i.kt)("inlineCode",{parentName:"p"},"AssetLoader")," class:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var assets = AvaloniaLocator.Current.GetService<IAssetLoader>();\nvar bitmap = new Bitmap(assets.Open(new Uri(uri)));\n")),(0,i.kt)("p",null,"Becomes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var bitmap = new Bitmap(AssetLoader.Open(new Uri(uri)));\n")),(0,i.kt)("h2",{id:"onpropertychanged"},"OnPropertyChanged"),(0,i.kt)("p",null,"The virtual ",(0,i.kt)("inlineCode",{parentName:"p"},"AvaloniaObject.OnPropertyChanged")," method is now non-generic. Replace"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"protected override void OnPropertyChanged<T>(AvaloniaPropertyChangedEventArgs<T> change)\n")),(0,i.kt)("p",null,"with"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"protected override void OnPropertyChanged(AvaloniaPropertyChangedEventArgs change)\n")),(0,i.kt)("p",null,"Also the technique for getting the old and new values from ",(0,i.kt)("inlineCode",{parentName:"p"},"AvaloniaPropertyChangedEventArgs")," without boxing has changed:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Replace ",(0,i.kt)("inlineCode",{parentName:"li"},"change.NewValue.GetValueOrDefault<T>()")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"change.GetNewValue<bool>()")),(0,i.kt)("li",{parentName:"ul"},"Replace ",(0,i.kt)("inlineCode",{parentName:"li"},"change.OldValue.GetValueOrDefault<T>()")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"change.GetOldValue<bool>()")),(0,i.kt)("li",{parentName:"ul"},"You can also use ",(0,i.kt)("inlineCode",{parentName:"li"},"change.GetOldAndNewValue<T>()")," to get both")),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/7980"},"#7980")," for more information."),(0,i.kt)("h2",{id:"events"},"Events"),(0,i.kt)("p",null,"The following events have been renamed:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"PointerEnter")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"PointerEntered")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"PointerLeave")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"PointerExited")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ContextMenu"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ContextMenuClosing")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Closing")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ContextMenuOpening")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Opening")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MenuBase"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MenuClosed")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Closed")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MenuOpened")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"Opened"))))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"RoutedEventArgs.Source")," has changed from type ",(0,i.kt)("inlineCode",{parentName:"p"},"IInteractive")," to type ",(0,i.kt)("inlineCode",{parentName:"p"},"object"),": cast to a concrete type such as ",(0,i.kt)("inlineCode",{parentName:"p"},"Control")," to use it."),(0,i.kt)("h2",{id:"layout"},"Layout"),(0,i.kt)("p",null,"Previously a full layout pass was achieved by getting the layout root and calling a method on the layout manager:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"((ILayoutRoot)control).LayoutManager.ExecuteLayout();\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"LayoutManager")," is no longer exposed from the ",(0,i.kt)("inlineCode",{parentName:"p"},"ILayoutRoot"),", instead call the ",(0,i.kt)("inlineCode",{parentName:"p"},"UpdateLayout")," method on any control as in WPF/UWP:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"control.UpdateLayout();\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ILayoutable")," was used in 0.10.x to get the previous measure constraints and arrange bounds. Because ",(0,i.kt)("inlineCode",{parentName:"p"},"ILayoutable")," is no longer available, these are now exposed from ",(0,i.kt)("inlineCode",{parentName:"p"},"LayoutInformation"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Size? LayoutInformation.GetPreviousMeasureConstraint(Layoutable control)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Rect? LayoutInformation.GetPreviousArrangeBounds(Layoutable control)"))),(0,i.kt)("h2",{id:"focus"},"Focus"),(0,i.kt)("p",null,"The focus manager is no longer available via ",(0,i.kt)("inlineCode",{parentName:"p"},"FocusManager.Instance")," and has instead been moved to the ",(0,i.kt)("inlineCode",{parentName:"p"},"TopLevel"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var focusManager = FocusManager.Instance;\n")),(0,i.kt)("p",null,"Becomes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"var focusManager = TopLevel.GetTopLevel(control).FocusManager;\n")),(0,i.kt)("p",null,"In addition, the ",(0,i.kt)("inlineCode",{parentName:"p"},"IFocusManager")," API has been changed."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"To get the currently focused element, use ",(0,i.kt)("inlineCode",{parentName:"li"},"IFocusManager.GetFocusedElement()")),(0,i.kt)("li",{parentName:"ul"},"To focus a control use ",(0,i.kt)("inlineCode",{parentName:"li"},"control.Focus()"))),(0,i.kt)("p",null,"There is currently no event for listening to focus changes on ",(0,i.kt)("inlineCode",{parentName:"p"},"IFocusManager"),". To listen for focus changes, add a listener to the ",(0,i.kt)("inlineCode",{parentName:"p"},"InputElement.GotFocusEvent"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"InputElement.GotFocusEvent.Raised.Subscribe(new AnonymousObserver<(object, RoutedEventArgs)>(x => { }));\n")),(0,i.kt)("p",null,"The same applied to KeyboardDevice, which isn't accessible anymore. Use the same focus related APIs as a replacement."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/11407"},"#11407")," for more information."),(0,i.kt)("h2",{id:"visual-tree"},"Visual Tree"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"IVisual")," was used in 0.10.x to expose the visual parent and visual children of a control. Because ",(0,i.kt)("inlineCode",{parentName:"p"},"IVisual")," is no longer available, these are now exposed as extension methods in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Avalonia.VisualTree")," namespace:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"using Avalonia.VisualTree;\n\nvar visualParent = control.GetVisualParent();\nvar visualChildren = control.GetVisualChildren();\n")),(0,i.kt)("h2",{id:"rendering"},"Rendering"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"Render")," method on certain controls is now sealed. This is because it is planned to make these controls use composition primitives instead of rendering via ",(0,i.kt)("inlineCode",{parentName:"p"},"DrawingContext"),"."),(0,i.kt)("p",null,"If you have a control whose ",(0,i.kt)("inlineCode",{parentName:"p"},"Render")," method was being overloaded but it's now sealed, consider using a base class, for example instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"Border")," use ",(0,i.kt)("inlineCode",{parentName:"p"},"Decorator"),". Note that you will now be responsible for drawing the background/border."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AvaloniaUI/Avalonia/pull/10299"},"#10299")," for more information."),(0,i.kt)("h2",{id:"locator"},"Locator"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AvaloniaLocator")," is no longer available. Most services that were available via the locator now have alternative methods of access:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"AssetLoader")," is a static class now with all of the old methods."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"IPlatformSettings")," was moved to ",(0,i.kt)("inlineCode",{parentName:"li"},"TopLevel.PlatformSettings")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"Application.PlatformSettings"),". Note, it's always preferred to use settings of the specific top level (window) rather than global ones."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"IClipboard")," was moved to the ",(0,i.kt)("inlineCode",{parentName:"li"},"TopLevel.Clipboard"),". Note, that ",(0,i.kt)("inlineCode",{parentName:"li"},"Application.Clipboard")," was removed as well."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"PlatformHotkeyConfiguration")," was moved to the ",(0,i.kt)("inlineCode",{parentName:"li"},"PlatformSettings.HotkeyConfiguration"),".")),(0,i.kt)("p",null,"Some applications were using the ",(0,i.kt)("inlineCode",{parentName:"p"},"AvaloniaLocator")," as a general-purpose service locator. This was never an intended usage of ",(0,i.kt)("inlineCode",{parentName:"p"},"AvaloniaLocator")," and those application should move to a service locator or DI container designed for the purpose, e.g. ",(0,i.kt)("a",{parentName:"p",href:"https://www.reactiveui.net/docs/handbook/dependency-inversion/"},(0,i.kt)("inlineCode",{parentName:"a"},"Splat"))," or ",(0,i.kt)("inlineCode",{parentName:"p"},"Microsoft.Extensions.DependencyInjection"),"."),(0,i.kt)("h2",{id:"miscellaneousadvanced-scenarios"},"Miscellaneous/Advanced Scenarios"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IRenderer"),"/",(0,i.kt)("inlineCode",{parentName:"li"},"DeferredRenderer"),"/",(0,i.kt)("inlineCode",{parentName:"li"},"ImmediateRenderer")," have now been removed. For performance reasons it is no longer possible to supply your own renderer, everything uses the new composition renderer."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Renderer.Diagnostics")," is now ",(0,i.kt)("inlineCode",{parentName:"li"},"RendererDiagnostics")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ICustomDrawOperation.Render")," now takes an ",(0,i.kt)("inlineCode",{parentName:"li"},"ImmediateDrawingContext")," instead of a ",(0,i.kt)("inlineCode",{parentName:"li"},"DrawingContext")),(0,i.kt)("li",{parentName:"ul"},"Add ",(0,i.kt)("inlineCode",{parentName:"li"},".GetTask()")," to the end of calls to ",(0,i.kt)("inlineCode",{parentName:"li"},"Dispatcher.UIThread.InvokeAsync")," if directly returning the value in a method which returns a ",(0,i.kt)("inlineCode",{parentName:"li"},"Task")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IRenderRoot.RenderScaling")," has been moved to ",(0,i.kt)("inlineCode",{parentName:"li"},"TopLevel.RenderScaling")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LightweightObservableBase")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"SingleSubscriberObservableBase")," have been made internal. These were utility classes designed for a specific purpose in Avalonia and were not intended to be used by clients as they do not handle certain edge cases. Use the mechanisms provided by ",(0,i.kt)("inlineCode",{parentName:"li"},"System.Reactive")," to create observables, such as ",(0,i.kt)("inlineCode",{parentName:"li"},"Observable.Create")),(0,i.kt)("li",{parentName:"ul"},"When binding to methods, the method must either have no parameters or a single object parameter."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"OpenFileDialog")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"SaveFileDialog")," have been removed. For file system storage service use ",(0,i.kt)("inlineCode",{parentName:"li"},"IStorageProvider")," on the Top Level.")))}u.isMDXComponent=!0}}]);